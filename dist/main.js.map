{"version":3,"sources":["../js/main.js"],"names":["Object","value","exports","_index","_interopRequireDefault","require","_enemy","_background","_gameinfo","_music","_databus","obj","instance","i","props","descriptor","_defineProperties","Constructor","ctx","canvas","databus","Main","_classCallCheck","_createClass","key","window","enemy","that","il","bullet","e","x","y","area","item","ani"],"mappings":"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","sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _index = _interopRequireDefault(require(\"./player/index\"));\n\nvar _enemy = _interopRequireDefault(require(\"./npc/enemy\"));\n\nvar _background = _interopRequireDefault(require(\"./runtime/background\"));\n\nvar _gameinfo = _interopRequireDefault(require(\"./runtime/gameinfo\"));\n\nvar _music = _interopRequireDefault(require(\"./runtime/music\"));\n\nvar _databus = _interopRequireDefault(require(\"./databus\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nvar ctx = canvas.getContext('2d');\nvar databus = new _databus[\"default\"]();\n/**\n * 游戏主函数\n */\n\nvar Main = /*#__PURE__*/function () {\n  function Main() {\n    _classCallCheck(this, Main);\n\n    // 维护当前requestAnimationFrame的id\n    this.aniId = 0;\n    this.restart();\n  }\n\n  _createClass(Main, [{\n    key: \"restart\",\n    value: function restart() {\n      databus.reset();\n      canvas.removeEventListener('touchstart', this.touchHandler);\n      this.bg = new _background[\"default\"](ctx);\n      this.player = new _index[\"default\"](ctx);\n      this.gameinfo = new _gameinfo[\"default\"]();\n      this.music = new _music[\"default\"]();\n      this.bindLoop = this.loop.bind(this);\n      this.hasEventBind = false; // 清除上一局的动画\n\n      window.cancelAnimationFrame(this.aniId);\n      this.aniId = window.requestAnimationFrame(this.bindLoop, canvas);\n    }\n    /**\n     * 随着帧数变化的敌机生成逻辑\n     * 帧数取模定义成生成的频率\n     */\n\n  }, {\n    key: \"enemyGenerate\",\n    value: function enemyGenerate() {\n      if (databus.frame % 30 === 0) {\n        var enemy = databus.pool.getItemByClass('enemy', _enemy[\"default\"]);\n        enemy.init(6);\n        databus.enemys.push(enemy);\n      }\n    } // 全局碰撞检测\n\n  }, {\n    key: \"collisionDetection\",\n    value: function collisionDetection() {\n      var that = this;\n      databus.bullets.forEach(function (bullet) {\n        for (var i = 0, il = databus.enemys.length; i < il; i++) {\n          var enemy = databus.enemys[i];\n\n          if (!enemy.isPlaying && enemy.isCollideWith(bullet)) {\n            enemy.playAnimation();\n            that.music.playExplosion();\n            bullet.visible = false;\n            databus.score += 1;\n            break;\n          }\n        }\n      });\n\n      for (var i = 0, il = databus.enemys.length; i < il; i++) {\n        var enemy = databus.enemys[i];\n\n        if (this.player.isCollideWith(enemy)) {\n          databus.gameOver = true;\n          break;\n        }\n      }\n    } // 游戏结束后的触摸事件处理逻辑\n\n  }, {\n    key: \"touchEventHandler\",\n    value: function touchEventHandler(e) {\n      e.preventDefault();\n      var x = e.touches[0].clientX;\n      var y = e.touches[0].clientY;\n      var area = this.gameinfo.btnArea;\n      if (x >= area.startX && x <= area.endX && y >= area.startY && y <= area.endY) this.restart();\n    }\n    /**\n     * canvas重绘函数\n     * 每一帧重新绘制所有的需要展示的元素\n     */\n\n  }, {\n    key: \"render\",\n    value: function render() {\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\n      this.bg.render(ctx);\n      databus.bullets.concat(databus.enemys).forEach(function (item) {\n        item.drawToCanvas(ctx);\n      });\n      this.player.drawToCanvas(ctx);\n      databus.animations.forEach(function (ani) {\n        if (ani.isPlaying) {\n          ani.aniRender(ctx);\n        }\n      });\n      this.gameinfo.renderGameScore(ctx, databus.score); // 游戏结束停止帧循环\n\n      if (databus.gameOver) {\n        this.gameinfo.renderGameOver(ctx, databus.score);\n\n        if (!this.hasEventBind) {\n          this.hasEventBind = true;\n          this.touchHandler = this.touchEventHandler.bind(this);\n          canvas.addEventListener('touchstart', this.touchHandler);\n        }\n      }\n    } // 游戏逻辑更新主函数\n\n  }, {\n    key: \"update\",\n    value: function update() {\n      if (databus.gameOver) return;\n      this.bg.update();\n      databus.bullets.concat(databus.enemys).forEach(function (item) {\n        item.update();\n      });\n      this.enemyGenerate();\n      this.collisionDetection();\n\n      if (databus.frame % 20 === 0) {\n        this.player.shoot();\n        this.music.playShoot();\n      }\n    } // 实现游戏帧循环\n\n  }, {\n    key: \"loop\",\n    value: function loop() {\n      databus.frame++;\n      this.update();\n      this.render();\n      this.aniId = window.requestAnimationFrame(this.bindLoop, canvas);\n    }\n  }]);\n\n  return Main;\n}();\n\nexports[\"default\"] = Main;"],"file":"main.js"}